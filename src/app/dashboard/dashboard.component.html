<div class="dashboard-bg">


  <div class="dashboard-header">
    <div class="dashboard-header-inner">
      <img src="rescue_radar_logo.png" alt="Rescue Radar Logo"/>
      <div>
        <h1>Rescue Radar</h1>
        <p>Daily insights into animal rescues in the greater Orlando / Central Florida area.</p>
      </div>
    </div>
  </div>


  <mat-tab-group>
    <mat-tab label="Today's Rescues">
      <section style="max-width: 900px; margin: 2rem auto; padding: 1rem;">
        <div class="todays-rescues-header">
          <svg class="sparkles-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#F59E0B" stroke-width="2.5"
               stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path
              d="M5 3v4M3 5h4M19 14v4M17 16h4M11 19v2M10 20h2M15.24 5.64l1.42-1.42M16.66 5.64l-1.42-1.42M6.76 18.36l-1.42 1.42M5.34 18.36l1.42 1.42"/>
          </svg>
          <h2>Today's Rescues</h2>
          <span class="green-badge">
    {{ todaysRescues?.total }} animals saved today! üéâ
  </span>
        </div>

        <div *ngIf="todaysRescues" style="margin-top: 1rem;">
          <!--        <p>New rescues listed today: <strong>{{ todaysRescues.total }}</strong></p>-->

          <h3 style="margin-top: 1rem;">Animal Type Breakdown</h3>


          <div class="type-breakdown-grid">
            <!-- Chart on the left -->
            <div class="chart-container">
              <canvas baseChart
                      [data]="todaysTypeChartData"
                      [options]="todaysTypeChartOptions"
                      [type]="'doughnut'">
              </canvas>
            </div>

            <!-- Animal type cards -->
            <div class="type-cards">
              <div *ngFor="let type of typeKeys" class="type-card"
                   [ngStyle]="{'border-color': typeColors[type] + '66'}">
                <div class="type-icon" [ngStyle]="{'background-color': typeColors[type]}">
                  {{ typeEmojis[type] || 'üêæ' }}
                </div>
                <div class="type-count" [style.color]="typeColors[type]">
                  {{ todaysRescues.typeBreakdown[type] }}
                </div>
                <div class="type-label">
                  {{ type }}
                </div>
              </div>
            </div>
          </div>

          <div class="top-org-card">
            <div class="top-org-header">
              <div class="top-org-emoji">üèÜ</div>
              <h3>Today's Top Organization</h3>
            </div>

            <div class="top-org-content">
              <div>
                <h4 class="top-org-name">{{ todaysRescues.topOrganization.name }}</h4>
                <p class="top-org-stats">
                  {{ todaysRescues.topOrganization.total }} rescues today:
                  <ng-container *ngFor="let type of topOrgTypeKeys; let isLast = last">
                    {{ todaysRescues.topOrganization.typeBreakdown[type] }} {{ type }}<span *ngIf="!isLast">, </span>
                  </ng-container>
                </p>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="!todaysRescues">
          <p>Loading today's rescues...</p>
        </div>

        <!-- === Featured Rescue Card === -->
        <div *ngIf="featuredAnimal" class="featured-animal-card fancy">
          <img [src]="featuredAnimal.primary_photo" alt="{{ featuredAnimal.name }}"/>

          <div class="animal-info">
            <!-- TOP ROW -->
            <div class="featured-animal-top">
              <div class="animal-header">
                <h3>{{ featuredAnimal.name }}</h3>
                <span class="badge">{{ featuredAnimal.primary_breed }}</span>
              </div>

              <div class="featured-controls">
                <div class="control-timer">
                  <svg class="clock-icon" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="#15803D"
                       stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                  </svg>
                  {{ countdown }}s
                </div>

                <button (click)="togglePause()" class="control-btn">
                  <svg *ngIf="isPaused" xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" stroke="#15803D"
                       stroke-width="2.2" viewBox="0 0 24 24">
                    <path d="M5 3l14 9-14 9V3z"/>
                  </svg>
                  <svg *ngIf="!isPaused" xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" stroke="#15803D"
                       stroke-width="2.2" viewBox="0 0 24 24">
                    <rect x="6" y="4" width="4" height="16"/>
                    <rect x="14" y="4" width="4" height="16"/>
                  </svg>
                </button>

                <button (click)="loadFeaturedAnimal()" class="control-btn">
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" stroke="#ec4899" stroke-width="2.2"
                       stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                    <path d="M5 4l10 8-10 8V4z"/>
                    <path d="M19 5v14"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- STACKED DETAILS -->
            <div class="animal-details">
              <p class="breed-org">Rescued by: {{ featuredAnimal.organization_name }}</p>
              <p class="age">Age: {{ featuredAnimal.age }}</p>
              <p *ngIf="featuredAnimal.description" class="desc"
                 [innerHTML]="decodeHtmlEntities(featuredAnimal.description)"></p>

              <div class="actions">
                <a [href]="featuredAnimal.url" target="_blank" rel="noopener" class="btn">
                  View Full Profile
                </a>
              </div>
            </div>
          </div>
        </div>


      </section>
    </mat-tab>

    <mat-tab label="Animal Type Distribution">
      <section style="max-width: 900px; margin: 2rem auto; padding: 1rem;">
        <h2 style="text-align: center; margin-bottom: 1rem;">Animal Type Distribution</h2>
        <p style="text-align: center; margin-bottom: 1rem;">Total animal counts since June 4, 2025</p>
        <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <canvas baseChart
                  #mainChart="base-chart"
                  [data]="chartData"
                  [options]="chartOptions"
                  [type]="'bar'">
          </canvas>
        </div>
      </section>
    </mat-tab>

    <mat-tab label="Spay/Neuter Status">
      <section style="max-width: 600px; margin: 2rem auto; padding: 1rem;">
        <h2 style="text-align: center; margin-bottom: 1rem;">Spay/Neuter Status</h2>
        <p style="text-align: center; margin-bottom: 1rem;">Overall distribution since June 4, 2025</p>
        <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <canvas baseChart
                  #spayChart="base-chart"
                  [data]="spayChartData"
                  [options]="spayChartOptions"
                  [type]="'doughnut'">
          </canvas>
        </div>
      </section>
    </mat-tab>

    <mat-tab label="Types Over Time">
      <section style="max-width: 1000px; margin: 2rem auto; padding: 1rem;">
        <h2 style="text-align: center; margin-bottom: 1rem;">Animal Types Over Time</h2>

        <div style="text-align: center; margin-bottom: 1rem;">
          <label for="type-select">Show data for : </label>
          <select [(ngModel)]="selectedTimeframe" (change)="updateTypeOverTimeChart()">
            <option *ngFor="let tf of timeframes" [value]="tf.value">{{ tf.label }}</option>
          </select>
        </div>

        <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <canvas baseChart
                  #typeOverTimeChart="base-chart"
                  [data]="typeOverTimeData"
                  [options]="typeOverTimeOptions"
                  [type]="'line'">
          </canvas>
        </div>
      </section>
    </mat-tab>

    <mat-tab label="Breed Trends">
      <section style="max-width: 1000px; margin: 2rem auto;">
        <h2 style="text-align: center;">Breeds Over Past 30 Days</h2>
        <div style="text-align: center; margin-bottom: 1rem;">
          <label for="type-select">Animal Type : </label>
          <select id="type-select" [(ngModel)]="selectedAnimalType" (change)="updateBreedChart(allAnimals)">
            <option *ngFor="let type of availableTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
        <div class="breed-chart-wrapper"
             style="background: #f9f9f9; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <canvas baseChart
                  #breedChart="base-chart"
                  [data]="breedChartData"
                  [options]="breedChartOptions"
                  [type]="'line'">
          </canvas>
        </div>
        <div class="custom-legend">
          <div *ngFor="let item of customLegendLabels" class="legend-item">
            <span class="legend-color" [style.backgroundColor]="item.color"></span>
            {{ item.label }}
          </div>
        </div>
      </section>
    </mat-tab>

    <mat-tab label="Top Organizations">
      <section style="max-width: 1000px; margin: 2rem auto;">
        <h2 style="text-align: center;">Top 20 Organizations by Animal Type (Past 30 Days)</h2>
        <div style="background: #f9f9f9; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <canvas baseChart
                  #orgStackedChart="base-chart"
                  [data]="orgStackedChartData"
                  [options]="orgStackedChartOptions"
                  [type]="'bar'">
          </canvas>
        </div>
      </section>
    </mat-tab>
  </mat-tab-group>

</div>
